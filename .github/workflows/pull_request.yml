name: Pull Request Test

on:
  push:
    branches:
      - main

jobs:
  pr:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Check out repository code
        uses: actions/checkout@v2

      - name: Run gh version
        run: |-
          gh --version

      - name: Auth login to GitHub
        run: |-
          echo ${{ secrets.GITHUB_TOKEN }} > token.txt
          gh auth login --with-token < token.txt

      - name: Create pull request
        run: |-
          echo '--- PR to main ---'
          gh pr list \
            --base main
          echo $?
          echo '--- PR to release ---'
          PR_LIST=$(gh pr list \
            --base release)
          echo $?
          echo '--- create PR ---'
          if [ -z "$PR_LIST" ]; then
            gh pr create \
              --base release \
              --title "To Release" \
              --body "Auto Generated by GitHub Actions" \
              --assignee "n0ts"
          fi
